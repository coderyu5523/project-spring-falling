{{>layout/header}}
<br>
<div class="artist-album-list-main-container">
    <div class="artist-album-list-contents">
        <div class="artist-album-list-album">
            <br>
            <div class="artist-album-list-result-item">
                <input type="hidden" id="artist-id" value="{{artist.artistId}}">
                <div class="artist-album-list-album-cover">
                    <a href="#">
                        <img src="{{artist.artistImage}}" alt="Artist Image">
                    </a>
                    <div>
                        <a href="#"><i class="artist-album-list-play-btn fas fa-solid fa-circle-play"></i></a>
                    </div>
                </div>
                <div class="artist-album-list-result-info">
                    <a href="#">
                        <h3 style="font-weight: 600;">{{artist.artistName}}</h3>
                    </a>
                    <div class="artist-album-list-album-info">
                        <p class="artist-album-list-album-category">{{artist.artistType}} | {{artist.artistGenre}}</p>
                    </div>

                    <div class="artist-album-list-icons">
                        {{#artist.isArtistLike}}
                            <a href="#"><i class="artist-album-list-btn-add-like fas fa-heart"></i></a>
                        {{/artist.isArtistLike}}
                        {{^artist.isArtistLike}}
                            <a href="#"><i class="artist-album-list-btn-add-like fa-regular fa-heart"></i></a>
                        {{/artist.isArtistLike}}
                        <a href="#" class="artist-album-list-title-play">
                            <i class="artist-album-list-title-play-btn fas fa-play play-button"></i>
                            <div class="artist-album-list-title-play-text">타이틀곡 듣기</div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <br>
        <div class="artist-album-list-tab-button">
            <button class="artist-album-list-song-list">곡</button>
            <button class="artist-album-list-album-list">앨범</button>
        </div>
        <div class="artist-album-list-song-list">
            <table class="artist-album-list-song-list-table">
                <div class="artist-album-list-filter">
                    <div class="artist-album-list-table-menu">
                        <div class="artist-album-list-table-order">
                            <div class="artist-album-list-filter-album-category">
                                <p class="artist-album-list-all" data-keyword="전체">
                                    전체
                                </p>
                                <p class="artist-album-list-album-category" data-keyword="정규/싱글">
                                    정규/싱글
                                </p>
                                <p class="artist-album-list-participation" data-keyword="미니">
                                    미니
                                </p>
                                <p>
                                    |
                                </p>
                            </div>
                            <div class="artist-album-list-filter-order-by">
                                <p class="artist-album-list-order-by-date" data-orderby="최신순">
                                    최신순
                                </p>
                                <p class="artist-album-list-order-by-popularity" data-orderby="인기순">
                                    인기순
                                </p>
                                <p class="artist-album-list-order-by-korean" data-orderby="가나다순">
                                    가나다순
                                </p>
                            </div>
                        </div>
                        <div>
                        </div>
                    </div>
                </div>
                <thead>
                <tr class="artist-main-table-header">
                    <td><input type="checkbox"></td>
                    <td>곡/앨범</td>
                    <td class="artist-album-list-table-artist">아티스트</td>
                    <td>듣기</td>
                    <td>재생목록</td>
                    <td>내 리스트</td>
                    <td>더보기</td>
                </tr>
                </thead>
                <tbody class="artist-album-list-tbody" id="artist-album-list-tbody">

                </tbody>
            </table>
        </div>
    </div>
</div>
<br>
<script type="module" src="/js/artist-detail.js"></script>
<script>
    $(document).ready(function () {
        // 초기화: 모든 옵션 초기화
        var selectedCategory = localStorage.getItem('selectedCategory') || "";
        var selectedOrderBy = localStorage.getItem('selectedOrderBy') || "";
        var artistId = $('#artist-id').val();

        // 저장된 값을 불러와서 적용
        if (selectedCategory) {
            $('.artist-album-list-filter-album-category p[data-keyword="' + selectedCategory + '"]').addClass('active');
        }
        if (selectedOrderBy) {
            $('.artist-album-list-filter-order-by p[data-orderby="' + selectedOrderBy + '"]').addClass('active');
        }

        // 전체, 정규/싱글, 참여 중 하나만 선택되도록 처리
        $('.artist-album-list-filter-album-category p').click(function (e) {
            e.preventDefault();
            var keyword = $(this).data('keyword');

            // 기존 선택 제거
            $('.artist-album-list-filter-album-category p').removeClass('active');
            $(this).addClass('active');

            // 선택된 카테고리 저장
            selectedCategory = keyword;

            // 필터링 함수 호출
            filterAlbums(selectedCategory, selectedOrderBy);
        });

        // 최신순, 인기순, 가나다순 중 하나만 선택되도록 처리
        $('.artist-album-list-filter-order-by p').click(function (e) {
            e.preventDefault();
            var orderBy = $(this).data('orderby');

            // 기존 선택 제거
            $('.artist-album-list-filter-order-by p').removeClass('active');
            $(this).addClass('active');

            // 선택된 정렬 순서 저장
            selectedOrderBy = orderBy;

            // 필터링 함수 호출
            filterAlbums(selectedCategory, selectedOrderBy);
        });


        function filterAlbums(category, orderBy) {
            console.log("Filtering songs by:", category, "Order by:", orderBy);
            getContent('/' + artistId + '/sort-and-filter/songs', songs);
        }

        function getContent(url, pageCallback) {
            $.ajax({
                url: url,
                method: 'GET',
                dataType: 'json',
                data: {
                    keyword: selectedCategory + "," + selectedOrderBy
                },
                success: function (data) {
                    console.log("AJAX Success:", data); // 콘솔 로그 추가
                    $("#artist-album-list-tbody").html(pageCallback(data.body))
                },
                error: function () {
                    alert("데이터 가져오기 실패");
                }
            })
        }

        // 노래 리스트
        function songs(body) {
            console.log("Rendering songs:", body); // 콘솔 로그 추가
            return body.map(item => {
                return `
                <tr class="artist-main-table-body">
                    <td><input type="checkbox"></td>
                    <td class="artist-album-list-table-album-container">
                        <a href="/albums/${item.albumId}/list">
                            <img src="..${item.coverImg}" alt="Album Cover">
                        </a>
                        <div class="artist-album-list-text-container">
                            <div class="artist-album-list-title-group">
                                <div class="artist-album-list-song-title">
                                    <a href="/songs/${item.songId}">
                                        ${item.title}
                                    </a>
                                </div>
                            </div>
                            <a href="/albums/${item.albumId}/list">
                                <p class="artist-album-list-album-title" style="font-size: 12px;">${item.albumTitle}</p>
                            </a>
                        </div>
                    </td>
                    <td class="artist-album-list-table-artist">
                        <a href="/artists/${artistId}">${item.artistName}</a>
                    </td>
                    <td>
                        <a href="#" class="play-btn" data-songid="${item.songId}" data-title="${item.title}"
                           data-artist="${item.artistName}" data-cover="${item.coverImg}" data-music="${item.musicFile}"
                           data-lyrics="${item.lyrics}" >
                            <i class="artist-album-list-play-btn fa-solid fa-play"></i>
                        </a>
                    </td>
                    <td>
                        <a href="#"><i class="artist-album-list-add-playlist-btn fas fa-list icon"></i></a>
                    </td>
                    <td>
                        <a href="#"><i
                                class="artist-album-list-add-list-btn fas fa-folder-plus custom-icon"></i></a>
                    </td>
                    <td>
                        <a href="#"><i class="artist-album-list-more-btn fas fa-ellipsis-h icon"></i></a>
                    </td>
                </tr>
            `;
            }).join('');
        }

        // 초기 로드 시 필터링 적용
        filterAlbums(selectedCategory, selectedOrderBy);
    });
</script>
{{>layout/footer}}
